<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TreeNote Component - Manual Test Page</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background: #f5f5f5;
    }

    h1 {
      margin-bottom: 10px;
      color: #333;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .panel h2 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }

    tree-note {
      min-height: 300px;
      max-height: 400px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      background: white;
      font-family: inherit;
      font-size: 14px;
    }

    .controls {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .controls h2 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    button {
      padding: 8px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    button:hover {
      background: #0056b3;
    }

    button:active {
      transform: translateY(1px);
    }

    .info {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .info h2 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }

    .info ul {
      list-style: none;
      padding: 0;
    }

    .info li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .info li:last-child {
      border-bottom: none;
    }

    .info code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    #output {
      background: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .output-label {
      font-weight: 600;
      margin-bottom: 10px;
      color: #333;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .event-log {
      background: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      max-height: 150px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    .event-log-item {
      padding: 4px 0;
      border-bottom: 1px solid #eee;
    }

    .event-log-item:last-child {
      border-bottom: none;
    }

    .event-name {
      color: #007bff;
      font-weight: 600;
    }

    .event-detail {
      color: #666;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <h1>TreeNote Component</h1>
  <p class="subtitle">A TipTap-based outliner web component for hierarchical note-taking</p>

  <div class="info">
    <h2>Keyboard Shortcuts</h2>
    <ul>
      <li><code>Enter</code> - Create a new node at the same indentation level</li>
      <li><code>Tab</code> - Indent the current node</li>
      <li><code>Shift+Tab</code> - Unindent the current node</li>
      <li><code>Backspace</code> (at start of empty node) - Delete node and merge with previous</li>
    </ul>
  </div>

  <div class="controls">
    <h2>Controls</h2>
    <div class="button-group">
      <button onclick="focusEditor()">Focus Editor</button>
      <button onclick="toggleReadonly()">Toggle Readonly</button>
      <button onclick="getContent()">Get JSON Content</button>
      <button onclick="getMarkdown()">Get Markdown</button>
      <button onclick="loadSample()">Load Sample Content</button>
      <button onclick="clearContent()">Clear Content</button>
      <button onclick="clearEventLog()">Clear Event Log</button>
    </div>

    <div class="output-label">Output:</div>
    <div id="output">Click a button to see output...</div>
  </div>

  <div class="container">
    <div class="panel">
      <h2>Editor</h2>
      <tree-note id="editor"></tree-note>
    </div>

    <div class="panel">
      <h2>Event Log</h2>
      <div id="event-log" class="event-log">
        <div style="color: #999;">Events will appear here...</div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="panel">
      <h2>Readonly Editor</h2>
      <tree-note id="readonly-editor" readonly></tree-note>
    </div>

    <div class="panel">
      <h2>Pre-populated Editor</h2>
      <tree-note id="prepopulated-editor"></tree-note>
    </div>
  </div>

  <script type="module">
    import './src/tree-note.ts';

    const editor = document.getElementById('editor');
    const readonlyEditor = document.getElementById('readonly-editor');
    const prepopulatedEditor = document.getElementById('prepopulated-editor');
    const output = document.getElementById('output');
    const eventLog = document.getElementById('event-log');

    // Set up event listeners for the main editor
    const events = ['change', 'node-created', 'node-indented', 'node-unindented'];

    events.forEach(eventName => {
      editor.addEventListener(eventName, (e) => {
        logEvent(eventName, e.detail);
      });
    });

    function logEvent(name, detail) {
      const item = document.createElement('div');
      item.className = 'event-log-item';

      const timestamp = new Date().toLocaleTimeString();
      const detailStr = detail ? JSON.stringify(detail, null, 2).substring(0, 100) : '';

      item.innerHTML = `
        <span style="color: #999;">[${timestamp}]</span>
        <span class="event-name">${name}</span>
        ${detailStr ? `<span class="event-detail">${detailStr}...</span>` : ''}
      `;

      eventLog.insertBefore(item, eventLog.firstChild);

      // Keep only last 20 events
      while (eventLog.children.length > 20) {
        eventLog.removeChild(eventLog.lastChild);
      }
    }

    // Set sample content for readonly editor
    const readonlySample = {
      type: 'doc',
      content: [
        {
          type: 'outlineNode',
          attrs: { level: 0 },
          content: [{ type: 'text', text: 'This editor is readonly' }]
        },
        {
          type: 'outlineNode',
          attrs: { level: 1 },
          content: [{ type: 'text', text: 'You cannot edit this content' }]
        },
        {
          type: 'outlineNode',
          attrs: { level: 1 },
          content: [{ type: 'text', text: 'But you can select and copy it' }]
        }
      ]
    };

    setTimeout(() => {
      readonlyEditor.setJSON(readonlySample);
    }, 100);

    // Set sample content for prepopulated editor
    const prepopulatedSample = {
      type: 'doc',
      content: [
        {
          type: 'outlineNode',
          attrs: { level: 0 },
          content: [{ type: 'text', text: 'Welcome to TreeNote' }]
        },
        {
          type: 'outlineNode',
          attrs: { level: 1 },
          content: [{ type: 'text', text: 'This is a nested item' }]
        },
        {
          type: 'outlineNode',
          attrs: { level: 2 },
          content: [{ type: 'text', text: 'You can nest items multiple levels deep' }]
        },
        {
          type: 'outlineNode',
          attrs: { level: 1 },
          content: [{ type: 'text', text: 'Try pressing Enter to create new nodes' }]
        },
        {
          type: 'outlineNode',
          attrs: { level: 0 },
          content: [{ type: 'text', text: 'Use Tab and Shift+Tab to indent/unindent' }]
        }
      ]
    };

    setTimeout(() => {
      prepopulatedEditor.setJSON(prepopulatedSample);
    }, 100);

    // Control functions
    window.focusEditor = () => {
      editor.focus();
      output.textContent = 'Editor focused';
    };

    window.toggleReadonly = () => {
      editor.readonly = !editor.readonly;
      output.textContent = `Readonly: ${editor.readonly}`;
    };

    window.getContent = () => {
      const content = editor.getJSON();
      output.textContent = JSON.stringify(content, null, 2);
    };

    window.getMarkdown = () => {
      const markdown = editor.markdown;
      output.textContent = markdown;
    };

    window.loadSample = () => {
      const sample = {
        type: 'doc',
        content: [
          {
            type: 'outlineNode',
            attrs: { level: 0 },
            content: [{ type: 'text', text: 'Project Planning' }]
          },
          {
            type: 'outlineNode',
            attrs: { level: 1 },
            content: [{ type: 'text', text: 'Phase 1: Research' }]
          },
          {
            type: 'outlineNode',
            attrs: { level: 2 },
            content: [{ type: 'text', text: 'Market analysis' }]
          },
          {
            type: 'outlineNode',
            attrs: { level: 2 },
            content: [{ type: 'text', text: 'Competitor research' }]
          },
          {
            type: 'outlineNode',
            attrs: { level: 1 },
            content: [{ type: 'text', text: 'Phase 2: Development' }]
          },
          {
            type: 'outlineNode',
            attrs: { level: 2 },
            content: [{ type: 'text', text: 'Build MVP' }]
          },
          {
            type: 'outlineNode',
            attrs: { level: 2 },
            content: [{ type: 'text', text: 'User testing' }]
          },
          {
            type: 'outlineNode',
            attrs: { level: 1 },
            content: [{ type: 'text', text: 'Phase 3: Launch' }]
          }
        ]
      };

      editor.setJSON(sample);
      output.textContent = 'Sample content loaded';
    };

    window.clearContent = () => {
      const empty = {
        type: 'doc',
        content: [
          {
            type: 'outlineNode',
            attrs: { level: 0 },
            content: []
          }
        ]
      };

      editor.setJSON(empty);
      output.textContent = 'Content cleared';
    };

    window.clearEventLog = () => {
      eventLog.innerHTML = '<div style="color: #999;">Events will appear here...</div>';
    };
  </script>
</body>
</html>
